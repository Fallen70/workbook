<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom"><title>WorkBook</title><link href="https://fallen70.github.io/workbook/" rel="alternate"></link><link href="https://fallen70.github.io/workbook/feeds/all.atom.xml" rel="self"></link><id>https://fallen70.github.io/workbook/</id><updated>2021-08-09T17:00:00+02:00</updated><entry><title>Télecharger certificats</title><link href="https://fallen70.github.io/workbook/telecharger-certificats.html" rel="alternate"></link><published>2021-08-09T17:00:00+02:00</published><updated>2021-08-09T17:00:00+02:00</updated><author><name>Fallen70</name></author><id>tag:fallen70.github.io,2021-08-09:/workbook/telecharger-certificats.html</id><content type="html">&lt;p&gt;Récupére tous les certificats affiché par &lt;code&gt;$HOST:$PORT&lt;/code&gt;.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;rm -rf /tmp/certs/
mkdir -p /tmp/certs/
openssl s_client -showcerts -connect &lt;span class="nv"&gt;$HOST&lt;/span&gt;:&lt;span class="nv"&gt;$PORT&lt;/span&gt; &amp;lt;/dev/null &lt;span class="m"&gt;2&lt;/span&gt;&amp;gt;/dev/null &lt;span class="p"&gt;|&lt;/span&gt; sed -n &lt;span class="s2"&gt;&amp;quot;/BEGIN CERTIFICATE/,/END CERTIFICATE/p&amp;quot;&lt;/span&gt; &lt;span class="p"&gt;|&lt;/span&gt; awk &lt;span class="s1"&gt;&amp;#39;BEGIN {c=0;} /BEGIN CERT/{c++} { print &amp;gt; &amp;quot;/tmp/certs/cert.&amp;quot; c &amp;quot;.pem&amp;quot;}&amp;#39;&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;</content><category term="Linux"></category><category term="admin-sys"></category><category term="openssl"></category></entry><entry><title>Génération de certificat</title><link href="https://fallen70.github.io/workbook/generation-de-certificat.html" rel="alternate"></link><published>2021-08-09T16:50:00+02:00</published><updated>2021-08-09T16:50:00+02:00</updated><author><name>Fallen70</name></author><id>tag:fallen70.github.io,2021-08-09:/workbook/generation-de-certificat.html</id><summary type="html">&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="ch"&gt;#!/bin/bash&lt;/span&gt;

&lt;span class="c1"&gt;# Nettoyage du dossier temporaire cible&lt;/span&gt;
rm -rf /tmp/@option.host@
mkdir -p /tmp/@option.host@

&lt;span class="c1"&gt;# Définition des fichiers cible&lt;/span&gt;
&lt;span class="nb"&gt;export&lt;/span&gt; &lt;span class="nv"&gt;host&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;server.name&amp;quot;&lt;/span&gt;
&lt;span class="nb"&gt;export&lt;/span&gt; &lt;span class="nv"&gt;key&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;/tmp/&amp;#39;&lt;/span&gt;&lt;span class="nv"&gt;$host&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;/&amp;#39;&lt;/span&gt;&lt;span class="nv"&gt;$host&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;.key&amp;#39;&lt;/span&gt;
&lt;span class="nb"&gt;export&lt;/span&gt; &lt;span class="nv"&gt;csr&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;/tmp/&amp;#39;&lt;/span&gt;&lt;span class="nv"&gt;$host&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;/&amp;#39;&lt;/span&gt;&lt;span class="nv"&gt;$host&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;.csr&amp;#39;&lt;/span&gt;
&lt;span class="nb"&gt;export&lt;/span&gt; &lt;span class="nv"&gt;srl&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;/tmp/&amp;#39;&lt;/span&gt;&lt;span class="nv"&gt;$host&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;/&amp;#39;&lt;/span&gt;&lt;span class="nv"&gt;$host&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;.srl&amp;#39;&lt;/span&gt;
&lt;span class="nb"&gt;export&lt;/span&gt; &lt;span class="nv"&gt;crt&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;/tmp/&amp;#39;&lt;/span&gt;&lt;span class="nv"&gt;$host&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;/&amp;#39;&lt;/span&gt;&lt;span class="nv"&gt;$host&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;.crt&amp;#39;&lt;/span&gt;

&lt;span class="c1"&gt;#-- generate …&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;</summary><content type="html">&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="ch"&gt;#!/bin/bash&lt;/span&gt;

&lt;span class="c1"&gt;# Nettoyage du dossier temporaire cible&lt;/span&gt;
rm -rf /tmp/@option.host@
mkdir -p /tmp/@option.host@

&lt;span class="c1"&gt;# Définition des fichiers cible&lt;/span&gt;
&lt;span class="nb"&gt;export&lt;/span&gt; &lt;span class="nv"&gt;host&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;server.name&amp;quot;&lt;/span&gt;
&lt;span class="nb"&gt;export&lt;/span&gt; &lt;span class="nv"&gt;key&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;/tmp/&amp;#39;&lt;/span&gt;&lt;span class="nv"&gt;$host&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;/&amp;#39;&lt;/span&gt;&lt;span class="nv"&gt;$host&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;.key&amp;#39;&lt;/span&gt;
&lt;span class="nb"&gt;export&lt;/span&gt; &lt;span class="nv"&gt;csr&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;/tmp/&amp;#39;&lt;/span&gt;&lt;span class="nv"&gt;$host&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;/&amp;#39;&lt;/span&gt;&lt;span class="nv"&gt;$host&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;.csr&amp;#39;&lt;/span&gt;
&lt;span class="nb"&gt;export&lt;/span&gt; &lt;span class="nv"&gt;srl&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;/tmp/&amp;#39;&lt;/span&gt;&lt;span class="nv"&gt;$host&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;/&amp;#39;&lt;/span&gt;&lt;span class="nv"&gt;$host&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;.srl&amp;#39;&lt;/span&gt;
&lt;span class="nb"&gt;export&lt;/span&gt; &lt;span class="nv"&gt;crt&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;/tmp/&amp;#39;&lt;/span&gt;&lt;span class="nv"&gt;$host&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;/&amp;#39;&lt;/span&gt;&lt;span class="nv"&gt;$host&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;.crt&amp;#39;&lt;/span&gt;

&lt;span class="c1"&gt;#-- generate key&lt;/span&gt;
openssl genrsa -out &lt;span class="si"&gt;${&lt;/span&gt;&lt;span class="nv"&gt;key&lt;/span&gt;&lt;span class="si"&gt;}&lt;/span&gt;  &lt;span class="nv"&gt;$RD_OPTION_KEY_SIZE&lt;/span&gt;

&lt;span class="c1"&gt;#-- generate csr&lt;/span&gt;
openssl req -new -key &lt;span class="si"&gt;${&lt;/span&gt;&lt;span class="nv"&gt;key&lt;/span&gt;&lt;span class="si"&gt;}&lt;/span&gt; -out &lt;span class="si"&gt;${&lt;/span&gt;&lt;span class="nv"&gt;csr&lt;/span&gt;&lt;span class="si"&gt;}&lt;/span&gt; -subj &lt;span class="s2"&gt;&amp;quot;/CN=@option.host@&amp;quot;&lt;/span&gt;

&lt;span class="c1"&gt;#-- generate self siging key&lt;/span&gt;
openssl x509 -req -days &lt;span class="nv"&gt;$RD_OPTION_KEY_DURATION&lt;/span&gt; -in &lt;span class="si"&gt;${&lt;/span&gt;&lt;span class="nv"&gt;csr&lt;/span&gt;&lt;span class="si"&gt;}&lt;/span&gt; -signkey &lt;span class="si"&gt;${&lt;/span&gt;&lt;span class="nv"&gt;key&lt;/span&gt;&lt;span class="si"&gt;}&lt;/span&gt; -out &lt;span class="si"&gt;${&lt;/span&gt;&lt;span class="nv"&gt;crt&lt;/span&gt;&lt;span class="si"&gt;}&lt;/span&gt;

&lt;span class="c1"&gt;#-- cleanup&lt;/span&gt;
rm -f &lt;span class="si"&gt;${&lt;/span&gt;&lt;span class="nv"&gt;srl&lt;/span&gt;&lt;span class="si"&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;</content><category term="Linux"></category><category term="admin-sys"></category><category term="openssl"></category></entry><entry><title>Vérifier la date de fin d'un certificat SSL</title><link href="https://fallen70.github.io/workbook/verifier-la-date-de-fin-dun-certificat-ssl.html" rel="alternate"></link><published>2021-08-09T16:20:00+02:00</published><updated>2021-08-09T16:20:00+02:00</updated><author><name>Fallen70</name></author><id>tag:fallen70.github.io,2021-08-09:/workbook/verifier-la-date-de-fin-dun-certificat-ssl.html</id><summary type="html">&lt;p&gt;Le script a pour but d'être éxécuter sur la machine cible en local avec un outil type rundeck.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="ch"&gt;#!/bin/sh&lt;/span&gt;

&lt;span class="nv"&gt;HOSTNAME&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;localhost&amp;quot;&lt;/span&gt;
&lt;span class="nv"&gt;PORT&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;443&amp;quot;&lt;/span&gt;
&lt;span class="nv"&gt;ALERT_X_DAY_BEFORE&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="m"&gt;10&lt;/span&gt;

&lt;span class="c1"&gt;# Get current date as timestamp&lt;/span&gt;
&lt;span class="nv"&gt;CURR_DATE&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="k"&gt;$(&lt;/span&gt;date +%s&lt;span class="k"&gt;)&lt;/span&gt;

&lt;span class="c1"&gt;# Get enddate from certificate of hostname:port identified&lt;/span&gt;
&lt;span class="nv"&gt;CERT_DATE_AS_STRING&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="k"&gt;$(&lt;/span&gt;&lt;span class="nb"&gt;echo&lt;/span&gt; &lt;span class="p"&gt;|&lt;/span&gt; openssl s_client -connect &lt;span class="si"&gt;${&lt;/span&gt;&lt;span class="nv"&gt;HOSTNAME&lt;/span&gt;&lt;span class="si"&gt;}&lt;/span&gt;:&lt;span class="si"&gt;${&lt;/span&gt;&lt;span class="nv"&gt;PORT&lt;/span&gt;&lt;span class="si"&gt;}&lt;/span&gt; &lt;span class="m"&gt;2 …&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;</summary><content type="html">&lt;p&gt;Le script a pour but d'être éxécuter sur la machine cible en local avec un outil type rundeck.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="ch"&gt;#!/bin/sh&lt;/span&gt;

&lt;span class="nv"&gt;HOSTNAME&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;localhost&amp;quot;&lt;/span&gt;
&lt;span class="nv"&gt;PORT&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;443&amp;quot;&lt;/span&gt;
&lt;span class="nv"&gt;ALERT_X_DAY_BEFORE&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="m"&gt;10&lt;/span&gt;

&lt;span class="c1"&gt;# Get current date as timestamp&lt;/span&gt;
&lt;span class="nv"&gt;CURR_DATE&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="k"&gt;$(&lt;/span&gt;date +%s&lt;span class="k"&gt;)&lt;/span&gt;

&lt;span class="c1"&gt;# Get enddate from certificate of hostname:port identified&lt;/span&gt;
&lt;span class="nv"&gt;CERT_DATE_AS_STRING&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="k"&gt;$(&lt;/span&gt;&lt;span class="nb"&gt;echo&lt;/span&gt; &lt;span class="p"&gt;|&lt;/span&gt; openssl s_client -connect &lt;span class="si"&gt;${&lt;/span&gt;&lt;span class="nv"&gt;HOSTNAME&lt;/span&gt;&lt;span class="si"&gt;}&lt;/span&gt;:&lt;span class="si"&gt;${&lt;/span&gt;&lt;span class="nv"&gt;PORT&lt;/span&gt;&lt;span class="si"&gt;}&lt;/span&gt; &lt;span class="m"&gt;2&lt;/span&gt;&amp;gt;/dev/null &lt;span class="p"&gt;|&lt;/span&gt; openssl x509 -enddate -noout &lt;span class="p"&gt;|&lt;/span&gt; cut -d &lt;span class="s1"&gt;&amp;#39;=&amp;#39;&lt;/span&gt; -f &lt;span class="m"&gt;2&lt;/span&gt;&lt;span class="k"&gt;)&lt;/span&gt;                                                                            

&lt;span class="nv"&gt;CERT_EXP_DATE&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="k"&gt;$(&lt;/span&gt;date --date&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;&lt;/span&gt;&lt;span class="si"&gt;${&lt;/span&gt;&lt;span class="nv"&gt;CERT_DATE_AS_STRING&lt;/span&gt;&lt;span class="si"&gt;}&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;&lt;/span&gt; +%s&lt;span class="k"&gt;)&lt;/span&gt;

&lt;span class="nv"&gt;DAYS_REMAINING&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="k"&gt;$((&lt;/span&gt; &lt;span class="o"&gt;(&lt;/span&gt; &lt;span class="nv"&gt;$CERT_EXP_DATE&lt;/span&gt; &lt;span class="o"&gt;-&lt;/span&gt; &lt;span class="nv"&gt;$CURR_DATE&lt;/span&gt; &lt;span class="o"&gt;)&lt;/span&gt; &lt;span class="o"&gt;/&lt;/span&gt; &lt;span class="m"&gt;86400&lt;/span&gt; &lt;span class="k"&gt;))&lt;/span&gt;

&lt;span class="k"&gt;if&lt;/span&gt; &lt;span class="o"&gt;[&lt;/span&gt; &lt;span class="nv"&gt;$DAYS_REMAINING&lt;/span&gt; -lt &lt;span class="m"&gt;0&lt;/span&gt; &lt;span class="o"&gt;]&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt; &lt;span class="k"&gt;then&lt;/span&gt;
  &lt;span class="nb"&gt;echo&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;Certificat expiré  sur &lt;/span&gt;&lt;span class="k"&gt;$(&lt;/span&gt;hostname -f&lt;span class="k"&gt;)&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;&lt;/span&gt;
  &lt;span class="nb"&gt;exit&lt;/span&gt; &lt;span class="m"&gt;1&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
&lt;span class="k"&gt;fi&lt;/span&gt;

&lt;span class="k"&gt;if&lt;/span&gt; &lt;span class="o"&gt;[&lt;/span&gt; &lt;span class="nv"&gt;$DAYS_REMAINING&lt;/span&gt; -lt &lt;span class="nv"&gt;$ALERT_X_DAY_BEFORE&lt;/span&gt; &lt;span class="o"&gt;]&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt; &lt;span class="k"&gt;then&lt;/span&gt;
  &lt;span class="nb"&gt;echo&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;&lt;/span&gt;&lt;span class="nv"&gt;$DAYS_REMAINING&lt;/span&gt;&lt;span class="s2"&gt; jours avant expiration sur &lt;/span&gt;&lt;span class="k"&gt;$(&lt;/span&gt;hostname -f&lt;span class="k"&gt;)&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;&lt;/span&gt;
  &lt;span class="nb"&gt;exit&lt;/span&gt; &lt;span class="m"&gt;1&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
&lt;span class="k"&gt;fi&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;</content><category term="Linux"></category><category term="admin-sys"></category><category term="openssl"></category></entry><entry><title>OpenSSL CheatSheat</title><link href="https://fallen70.github.io/workbook/openssl-cheatsheat.html" rel="alternate"></link><published>2021-08-09T16:00:00+02:00</published><updated>2021-08-09T16:00:00+02:00</updated><author><name>Fallen70</name></author><id>tag:fallen70.github.io,2021-08-09:/workbook/openssl-cheatsheat.html</id><summary type="html">&lt;p&gt;Sources :&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href="https://www.kinamo.fr/fr/support/faq/commandes-openssl-utiles"&gt;https://www.kinamo.fr/fr/support/faq/commandes-openssl-utiles&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://www.system-linux.eu/index.php?post/2017/03/03/Convertir-un-fichier-pfx-en-crt-et-key"&gt;https://www.system-linux.eu/index.php?post/2017/03/03/Convertir-un-fichier-pfx-en-crt-et-key&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;h1&gt;OpenSSL - commandes utiles&lt;/h1&gt;
&lt;h2&gt;Comment se servir d'OpenSSL?&lt;/h2&gt;
&lt;p&gt;OpenSSL est véritablement le couteau suisse de la gestion de certificats, mais à l'instar du canif suisse, on passe un temps fou à …&lt;/p&gt;</summary><content type="html">&lt;p&gt;Sources :&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href="https://www.kinamo.fr/fr/support/faq/commandes-openssl-utiles"&gt;https://www.kinamo.fr/fr/support/faq/commandes-openssl-utiles&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://www.system-linux.eu/index.php?post/2017/03/03/Convertir-un-fichier-pfx-en-crt-et-key"&gt;https://www.system-linux.eu/index.php?post/2017/03/03/Convertir-un-fichier-pfx-en-crt-et-key&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;h1&gt;OpenSSL - commandes utiles&lt;/h1&gt;
&lt;h2&gt;Comment se servir d'OpenSSL?&lt;/h2&gt;
&lt;p&gt;OpenSSL est véritablement le couteau suisse de la gestion de certificats, mais à l'instar du canif suisse, on passe un temps fou à essayer de distinguer la lime à ongles du tire-bouchon. Vous trouverez ci-dessous une liste des commandes les plus fréquemment utilisées.&lt;/p&gt;
&lt;h2&gt;Demandes de certificats et gestion de clés&lt;/h2&gt;
&lt;p&gt;Si vous avez commandé un certificat, il faut générer une demande de certificat pour finaliser la commande. Vous pouvez le faire comme suivant, avec une nouvelle private key:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;openssl req -sha256 -nodes -newkey rsa:2048 -keyout www.server.com.key -out www.server.com.csr
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;Vous pouvez également employer le Générateur de CSR Kinamo pour créer votre CSR.
Générer une nouvelle demande de certificat à base d'une clé existante:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;openssl req -new -sha256 -key www.server.com.key -out www.server.com.csr
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;Générer une demande de certificat à base d'un certificat existant:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;openssl x509 -x509toreq -in www.server.com.crt -out www.server.com.csr -signkey www.server.com.key
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;Générer une nouvelle clé RSA:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;openssl genrsa -out www.server.com.key &lt;span class="m"&gt;2048&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;Générer une nouvelle clé ECC:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;openssl ecparam -out server.key -name prime256v1 -genkey
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;Générer un certificat auto-signé (self-signed) pour des tests:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;openssl req -x509 -newkey rsa:2048 -nodes -keyout www.server.com.key -out www.server.com.crt -days &lt;span class="m"&gt;365&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;h2&gt;Afficher et contrôler les certificats&lt;/h2&gt;
&lt;p&gt;Contrôler et afficher une demande de certificat:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;openssl req -noout -text -verify -in www.server.com.csr
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;Contrôler et afficher une clé privée et publique:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;openssl rsa -noout -text -check -in www.server.com.key
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;Afficher le contenu décodé d'un certificat en format PEM:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;openssl x509 -noout -text -in www.server.com.crt
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;Afficher le contenu d'un certificat en format PKCS#7:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;openssl pkcs7 -print_certs -in www.server.com.p7b
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;Afficher le contenu d'un certificat et d'une clé en format PKCS#12:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;openssl pkcs12 -info -in www.server.com.pfx
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;Contrôler une connection SSL et afficher tous les certificats intermédiaires:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;openssl s_client -connect www.server.com:443
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;Contrôler si un certificat, une demande de certificat et une clé ont la même clé publique:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;openssl x509 -noout -modulus www.server.com.crt &lt;span class="p"&gt;|&lt;/span&gt; openssl sha256
openssl req -noout -modulus www.server.com.csr &lt;span class="p"&gt;|&lt;/span&gt; openssl sha256
openssl rsa -noout -modulus www.server.com.key &lt;span class="p"&gt;|&lt;/span&gt; openssl sha256
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;h2&gt;Convertir des certificats&lt;/h2&gt;
&lt;p&gt;Conversion d'un fichier PKCS#12 ( .pfx .p12, typiquement utulisé sur Microsoft Windows) contenant clé privée et certificat vers le format PEM (utilisé sur Linux):&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;openssl pkcs12 -nodes -in www.server.com.pfx -out www.server.com.crt
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;Conversion du format PEM vers le format PKCS#12:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;openssl pkcs12 -export -in www.server.com.crt -inkey www.server.com.key -out www.server.com.pfx
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;Conversion du format PKCS#7 ( .p7b .p7c ) vers le format PEM:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;openssl pkcs7 -print_certs -in www.server.com.p7b -out www.server.com.crt  
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;Conversion du format PEM vers le format PKCS#7:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;openssl crl2pkcs7 -nocrl -certfile www.server.com.crt -out www.server.com.p7b
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;Conversion du format DER (.crt .cer ou .der) vers le format PEM:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;openssl x509 -inform der -in certificate.cer -out certificate.pem
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;h2&gt;Extraire la clef :&lt;/h2&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;openssl pkcs12 -in votre.pfx -nocerts -out votre.key -nodes
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;h2&gt;Extraire le certificat :&lt;/h2&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;openssl pkcs12 -in votre.pfx -clcerts -nokeys -out votre.crt
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;h2&gt;Créer le fullchain.pem&lt;/h2&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;openssl pkcs12 -in votre.pfx -out fullchain.pem -nodes
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;h2&gt;Générer une demande de certificat à base d'un certificat existant:&lt;/h2&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;openssl x509 -x509toreq -in www.server.com.crt -out www.server.com.csr -signkey ww.server.com.key
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;</content><category term="Linux"></category><category term="admin-sys"></category><category term="openssl"></category></entry><entry><title>Cacher information Serveur</title><link href="https://fallen70.github.io/workbook/cacher-information-serveur.html" rel="alternate"></link><published>2021-08-06T13:50:00+02:00</published><updated>2021-08-06T13:50:00+02:00</updated><author><name>Fallen70</name></author><id>tag:fallen70.github.io,2021-08-06:/workbook/cacher-information-serveur.html</id><summary type="html">&lt;p&gt;Source :&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href="https://www.if-not-true-then-false.com/2009/howto-hide-and-modify-apache-server-information-serversignature-and-servertokens-and-hide-php-version-x-powered-by/"&gt;https://www.if-not-true-then-false.com/2009/howto-hide-and-modify-apache-server-information-serversignature-and-servertokens-and-hide-php-version-x-powered-by/&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Pour tester :&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;$ lynx -head -mime_header http://www.ubuntu.com
HTTP/1.0 &lt;span class="m"&gt;200&lt;/span&gt; OK
Date: Fri, &lt;span class="m"&gt;20&lt;/span&gt; Nov &lt;span class="m"&gt;2009&lt;/span&gt; &lt;span class="m"&gt;09&lt;/span&gt;:25:46 GMT
Server: Apache/2.2.8 &lt;span class="o"&gt;(&lt;/span&gt;Ubuntu&lt;span class="o"&gt;)&lt;/span&gt; mod_python/3.3.1 Python/2.5.2 PHP/5.2.4-2ubuntu5.7 with …&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;</summary><content type="html">&lt;p&gt;Source :&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href="https://www.if-not-true-then-false.com/2009/howto-hide-and-modify-apache-server-information-serversignature-and-servertokens-and-hide-php-version-x-powered-by/"&gt;https://www.if-not-true-then-false.com/2009/howto-hide-and-modify-apache-server-information-serversignature-and-servertokens-and-hide-php-version-x-powered-by/&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Pour tester :&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;$ lynx -head -mime_header http://www.ubuntu.com
HTTP/1.0 &lt;span class="m"&gt;200&lt;/span&gt; OK
Date: Fri, &lt;span class="m"&gt;20&lt;/span&gt; Nov &lt;span class="m"&gt;2009&lt;/span&gt; &lt;span class="m"&gt;09&lt;/span&gt;:25:46 GMT
Server: Apache/2.2.8 &lt;span class="o"&gt;(&lt;/span&gt;Ubuntu&lt;span class="o"&gt;)&lt;/span&gt; mod_python/3.3.1 Python/2.5.2 PHP/5.2.4-2ubuntu5.7 with Suhosin-Patch mod_ssl/2.2.8 OpenSSL/0.9.8g
X-Powered-By: PHP/5.2.4-2ubuntu5.7
Content-Type: text/html&lt;span class="p"&gt;;&lt;/span&gt; &lt;span class="nv"&gt;charset&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;utf-8
Age: &lt;span class="m"&gt;13&lt;/span&gt;
Content-Length: &lt;span class="m"&gt;0&lt;/span&gt;
X-Cache: HIT from avocado.canonical.com
X-Cache-Lookup: HIT from avocado.canonical.com:80
Via: &lt;span class="m"&gt;1&lt;/span&gt;.0 avocado.canonical.com:80 &lt;span class="o"&gt;(&lt;/span&gt;squid/2.6.STABLE18&lt;span class="o"&gt;)&lt;/span&gt;
Connection: close
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;h1&gt;Summary&lt;/h1&gt;
&lt;p&gt;Safest basic setup is following:
httpd.conf or apache.conf rows:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;ServerSignature Off
ServerTokens Prod
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;php.ini row:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;expose_php = Off
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;After all changes remember reload server and check results. The results should look like this:&lt;/p&gt;
&lt;p&gt;Before:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="nt"&gt;HTTP&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="nt"&gt;1&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nc"&gt;1&lt;/span&gt; &lt;span class="nt"&gt;200&lt;/span&gt; &lt;span class="nt"&gt;OK&lt;/span&gt;
&lt;span class="nt"&gt;Date&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="nt"&gt;Fri&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt; &lt;span class="nt"&gt;20&lt;/span&gt; &lt;span class="nt"&gt;Nov&lt;/span&gt; &lt;span class="nt"&gt;2009&lt;/span&gt; &lt;span class="nt"&gt;12&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="nd"&gt;20&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="nd"&gt;30&lt;/span&gt; &lt;span class="nt"&gt;GMT&lt;/span&gt;
&lt;span class="nt"&gt;Server&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="nt"&gt;Apache&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="nt"&gt;2&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nc"&gt;2&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nc"&gt;4&lt;/span&gt; &lt;span class="o"&gt;(&lt;/span&gt;&lt;span class="nt"&gt;Ubuntu&lt;/span&gt;&lt;span class="o"&gt;)&lt;/span&gt; &lt;span class="nt"&gt;PHP&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="nt"&gt;5&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nc"&gt;2&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nc"&gt;3-1ubuntu6&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nc"&gt;4&lt;/span&gt;
&lt;span class="nt"&gt;X-Powered-By&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="nt"&gt;PHP&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="nt"&gt;5&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nc"&gt;2&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nc"&gt;3-1ubuntu6&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nc"&gt;4&lt;/span&gt;
&lt;span class="nt"&gt;Connection&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="nt"&gt;close&lt;/span&gt;
&lt;span class="nt"&gt;Content-Type&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="nt"&gt;text&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="nt"&gt;html&lt;/span&gt;&lt;span class="o"&gt;;&lt;/span&gt; &lt;span class="nt"&gt;charset&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="nt"&gt;UTF-8&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;After:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="nt"&gt;HTTP&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="nt"&gt;1&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nc"&gt;1&lt;/span&gt; &lt;span class="nt"&gt;200&lt;/span&gt; &lt;span class="nt"&gt;OK&lt;/span&gt;
&lt;span class="nt"&gt;Date&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="nt"&gt;Fri&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt; &lt;span class="nt"&gt;20&lt;/span&gt; &lt;span class="nt"&gt;Nov&lt;/span&gt; &lt;span class="nt"&gt;2009&lt;/span&gt; &lt;span class="nt"&gt;13&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="nd"&gt;06&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="nd"&gt;21&lt;/span&gt; &lt;span class="nt"&gt;GMT&lt;/span&gt;
&lt;span class="nt"&gt;Server&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="nt"&gt;Apache&lt;/span&gt;
&lt;span class="nt"&gt;Connection&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="nt"&gt;close&lt;/span&gt;
&lt;span class="nt"&gt;Content-Type&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="nt"&gt;text&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="nt"&gt;html&lt;/span&gt;&lt;span class="o"&gt;;&lt;/span&gt; &lt;span class="nt"&gt;charset&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="nt"&gt;UTF-8&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;</content><category term="Linux"></category><category term="admin-sys"></category><category term="apache"></category><category term="php"></category></entry><entry><title>Copie clef publique ssh</title><link href="https://fallen70.github.io/workbook/copie-clef-publique-ssh.html" rel="alternate"></link><published>2021-08-06T13:50:00+02:00</published><updated>2021-08-06T13:50:00+02:00</updated><author><name>Fallen70</name></author><id>tag:fallen70.github.io,2021-08-06:/workbook/copie-clef-publique-ssh.html</id><summary type="html">&lt;h1&gt;bash&lt;/h1&gt;
&lt;p&gt;Liste les cibles dans hosts.txt&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="ch"&gt;#!/bin/bash&lt;/span&gt;
 
&lt;span class="k"&gt;for&lt;/span&gt; host &lt;span class="k"&gt;in&lt;/span&gt; &lt;span class="k"&gt;$(&lt;/span&gt;cat ./hosts.txt&lt;span class="k"&gt;)&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt; &lt;span class="k"&gt;do&lt;/span&gt;
&lt;span class="nb"&gt;echo&lt;/span&gt; &lt;span class="nv"&gt;$host&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
cat ~/.ssh/id_rsa.pub &lt;span class="p"&gt;|&lt;/span&gt; ssh root@&lt;span class="si"&gt;${&lt;/span&gt;&lt;span class="nv"&gt;host&lt;/span&gt;&lt;span class="si"&gt;}&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;cat &amp;gt;&amp;gt; ~/.ssh/authorized_keys&amp;#39;&lt;/span&gt;
&lt;span class="k"&gt;done&lt;/span&gt; 

&lt;span class="k"&gt;for&lt;/span&gt; host &lt;span class="k"&gt;in&lt;/span&gt; &lt;span class="k"&gt;$(&lt;/span&gt;cat ./hosts.txt&lt;span class="k"&gt;)&lt;/span&gt; &lt;span class="p"&gt;;&lt;/span&gt; &lt;span class="k"&gt;do&lt;/span&gt; &lt;span class="nb"&gt;echo&lt;/span&gt; &lt;span class="nv"&gt;$host&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt; sshpass -p &lt;span class="s1"&gt;&amp;#39;&amp;lt;password&amp;gt;&amp;#39;&lt;/span&gt; ssh-copy-id root@&lt;span class="si"&gt;${&lt;/span&gt;&lt;span class="nv"&gt;host&lt;/span&gt;&lt;span class="si"&gt;}&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt; &lt;span class="k"&gt;done&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt; 
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;h1&gt;ansible&lt;/h1&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="p p-Indicator"&gt;-&lt;/span&gt; &lt;span class="nt"&gt;hosts&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="l l-Scalar l-Scalar-Plain"&gt;servers_to_update&lt;/span&gt; 
  &lt;span class="nt"&gt;remote_user&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="l l-Scalar l-Scalar-Plain"&gt;root …&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;</summary><content type="html">&lt;h1&gt;bash&lt;/h1&gt;
&lt;p&gt;Liste les cibles dans hosts.txt&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="ch"&gt;#!/bin/bash&lt;/span&gt;
 
&lt;span class="k"&gt;for&lt;/span&gt; host &lt;span class="k"&gt;in&lt;/span&gt; &lt;span class="k"&gt;$(&lt;/span&gt;cat ./hosts.txt&lt;span class="k"&gt;)&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt; &lt;span class="k"&gt;do&lt;/span&gt;
&lt;span class="nb"&gt;echo&lt;/span&gt; &lt;span class="nv"&gt;$host&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
cat ~/.ssh/id_rsa.pub &lt;span class="p"&gt;|&lt;/span&gt; ssh root@&lt;span class="si"&gt;${&lt;/span&gt;&lt;span class="nv"&gt;host&lt;/span&gt;&lt;span class="si"&gt;}&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;cat &amp;gt;&amp;gt; ~/.ssh/authorized_keys&amp;#39;&lt;/span&gt;
&lt;span class="k"&gt;done&lt;/span&gt; 

&lt;span class="k"&gt;for&lt;/span&gt; host &lt;span class="k"&gt;in&lt;/span&gt; &lt;span class="k"&gt;$(&lt;/span&gt;cat ./hosts.txt&lt;span class="k"&gt;)&lt;/span&gt; &lt;span class="p"&gt;;&lt;/span&gt; &lt;span class="k"&gt;do&lt;/span&gt; &lt;span class="nb"&gt;echo&lt;/span&gt; &lt;span class="nv"&gt;$host&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt; sshpass -p &lt;span class="s1"&gt;&amp;#39;&amp;lt;password&amp;gt;&amp;#39;&lt;/span&gt; ssh-copy-id root@&lt;span class="si"&gt;${&lt;/span&gt;&lt;span class="nv"&gt;host&lt;/span&gt;&lt;span class="si"&gt;}&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt; &lt;span class="k"&gt;done&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt; 
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;h1&gt;ansible&lt;/h1&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="p p-Indicator"&gt;-&lt;/span&gt; &lt;span class="nt"&gt;hosts&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="l l-Scalar l-Scalar-Plain"&gt;servers_to_update&lt;/span&gt; 
  &lt;span class="nt"&gt;remote_user&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="l l-Scalar l-Scalar-Plain"&gt;root&lt;/span&gt;
  &lt;span class="nt"&gt;become&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="l l-Scalar l-Scalar-Plain"&gt;yes&lt;/span&gt;
  &lt;span class="nt"&gt;become_method&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="l l-Scalar l-Scalar-Plain"&gt;sudo&lt;/span&gt;
  &lt;span class="nt"&gt;tasks&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
    &lt;span class="p p-Indicator"&gt;-&lt;/span&gt; &lt;span class="nt"&gt;name&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="s"&gt;&amp;quot;Copie&lt;/span&gt;&lt;span class="nv"&gt; &lt;/span&gt;&lt;span class="s"&gt;de&lt;/span&gt;&lt;span class="nv"&gt; &lt;/span&gt;&lt;span class="s"&gt;la&lt;/span&gt;&lt;span class="nv"&gt; &lt;/span&gt;&lt;span class="s"&gt;clef&lt;/span&gt;&lt;span class="nv"&gt; &lt;/span&gt;&lt;span class="s"&gt;publique&amp;quot;&lt;/span&gt; 
      &lt;span class="nt"&gt;authorized_key&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
        &lt;span class="nt"&gt;user&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="s"&gt;&amp;quot;{{&lt;/span&gt;&lt;span class="nv"&gt; &lt;/span&gt;&lt;span class="s"&gt;authorised_username&lt;/span&gt;&lt;span class="nv"&gt; &lt;/span&gt;&lt;span class="s"&gt;}}&amp;quot;&lt;/span&gt;
        &lt;span class="nt"&gt;state&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="l l-Scalar l-Scalar-Plain"&gt;present&lt;/span&gt;
        &lt;span class="nt"&gt;key&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="s"&gt;&amp;quot;{{&lt;/span&gt;&lt;span class="nv"&gt; &lt;/span&gt;&lt;span class="s"&gt;lookup(&amp;#39;file&amp;#39;,&lt;/span&gt;&lt;span class="nv"&gt; &lt;/span&gt;&lt;span class="s"&gt;&amp;#39;files/ssh_pub/id_rsa.pub&amp;#39;)&lt;/span&gt;&lt;span class="nv"&gt; &lt;/span&gt;&lt;span class="s"&gt;}}&amp;quot;&lt;/span&gt;
  &lt;span class="nt"&gt;tags&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="l l-Scalar l-Scalar-Plain"&gt;always&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;</content><category term="Linux"></category><category term="ssh"></category><category term="ansible"></category></entry><entry><title>Debug envoi de mail</title><link href="https://fallen70.github.io/workbook/debug-envoi-de-mail.html" rel="alternate"></link><published>2021-08-06T13:50:00+02:00</published><updated>2021-08-06T13:50:00+02:00</updated><author><name>Fallen70</name></author><id>tag:fallen70.github.io,2021-08-06:/workbook/debug-envoi-de-mail.html</id><summary type="html">&lt;h1&gt;sendmail&lt;/h1&gt;
&lt;h2&gt;Test simple&lt;/h2&gt;
&lt;p&gt;Ecrire le contenu a envoyer dans /tmp/test.mail&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;sendmail -v recipient@domain &amp;lt; /tmp/test.mail
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;h2&gt;Queue&lt;/h2&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;mailq
sendmail -bp
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;h2&gt;Aggregation des erreurs des mails dans la queue&lt;/h2&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;mailq &lt;span class="p"&gt;|&lt;/span&gt; grep smtpmailer.domain &lt;span class="p"&gt;|&lt;/span&gt; sort  &lt;span class="p"&gt;|&lt;/span&gt; uniq -c &lt;span class="p"&gt;|&lt;/span&gt; sort
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;h2&gt;Forcer l'envoi des mails en attente&lt;/h2&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;sendmail -q -v
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;h1&gt;Debug exchange …&lt;/h1&gt;</summary><content type="html">&lt;h1&gt;sendmail&lt;/h1&gt;
&lt;h2&gt;Test simple&lt;/h2&gt;
&lt;p&gt;Ecrire le contenu a envoyer dans /tmp/test.mail&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;sendmail -v recipient@domain &amp;lt; /tmp/test.mail
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;h2&gt;Queue&lt;/h2&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;mailq
sendmail -bp
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;h2&gt;Aggregation des erreurs des mails dans la queue&lt;/h2&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;mailq &lt;span class="p"&gt;|&lt;/span&gt; grep smtpmailer.domain &lt;span class="p"&gt;|&lt;/span&gt; sort  &lt;span class="p"&gt;|&lt;/span&gt; uniq -c &lt;span class="p"&gt;|&lt;/span&gt; sort
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;h2&gt;Forcer l'envoi des mails en attente&lt;/h2&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;sendmail -q -v
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;h1&gt;Debug exchange avec  telnet&lt;/h1&gt;
&lt;p&gt;Source :&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href="https://docs.microsoft.com/en-us/exchange/mail-flow/test-smtp-with-telnet?view=exchserver-2019"&gt;https://docs.microsoft.com/en-us/exchange/mail-flow/test-smtp-with-telnet?view=exchserver-2019&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;telnet smtpmailer.domain &lt;span class="m"&gt;25&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;Il faut ensuite taper chaque ligne suivante, valider avec la touche &lt;code&gt;entrée&lt;/code&gt;.&lt;/p&gt;
&lt;p&gt;&lt;code&gt;EHLO domain&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;&lt;code&gt;MAIL FROM: &amp;lt;sender@domain&amp;gt;&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;&lt;code&gt;RCPT TO: &amp;lt;recipient@domain&amp;gt; NOTIFY=success,failure&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;&lt;code&gt;DATA&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;&lt;code&gt;Subject: Telnet&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;&lt;code&gt;Envoyé avec telnet.&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;&lt;code&gt;.&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;&lt;code&gt;QUIT&lt;/code&gt;&lt;/p&gt;</content><category term="Linux"></category><category term="admin-sys"></category><category term="sendmail"></category><category term="exchange"></category></entry><entry><title>Logrotate</title><link href="https://fallen70.github.io/workbook/logrotate.html" rel="alternate"></link><published>2021-08-06T13:50:00+02:00</published><updated>2021-08-06T13:50:00+02:00</updated><author><name>Fallen70</name></author><id>tag:fallen70.github.io,2021-08-06:/workbook/logrotate.html</id><summary type="html">&lt;p&gt;Source :&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href="https://www.croc-informatique.fr/2009/06/rotation-des-logs-avec-logrotate/"&gt;https://www.croc-informatique.fr/2009/06/rotation-des-logs-avec-logrotate/&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="http://www.delafond.org/traducmanfr/man/man8/logrotate.8.html"&gt;http://www.delafond.org/traducmanfr/man/man8/logrotate.8.html&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Créer un fichier du nom de votre service (pour mémo) dans le répertoire /etc/logrotate.d. Nous allons prendre pour exemple le service postfix :&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;  vi /etc/logrotate.d/postfix
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;Saisissez ces quelques …&lt;/p&gt;</summary><content type="html">&lt;p&gt;Source :&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href="https://www.croc-informatique.fr/2009/06/rotation-des-logs-avec-logrotate/"&gt;https://www.croc-informatique.fr/2009/06/rotation-des-logs-avec-logrotate/&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="http://www.delafond.org/traducmanfr/man/man8/logrotate.8.html"&gt;http://www.delafond.org/traducmanfr/man/man8/logrotate.8.html&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Créer un fichier du nom de votre service (pour mémo) dans le répertoire /etc/logrotate.d. Nous allons prendre pour exemple le service postfix :&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;  vi /etc/logrotate.d/postfix
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;Saisissez ces quelques lignes :&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;  &lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="k"&gt;var&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="nb"&gt;log&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;maillog&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
  &lt;span class="n"&gt;daily&lt;/span&gt;
  &lt;span class="n"&gt;missingok&lt;/span&gt;
  &lt;span class="n"&gt;rotate&lt;/span&gt; &lt;span class="mi"&gt;52&lt;/span&gt;
  &lt;span class="n"&gt;compress&lt;/span&gt;
  &lt;span class="n"&gt;delaycompress&lt;/span&gt;
  &lt;span class="n"&gt;notifempty&lt;/span&gt;
  &lt;span class="n"&gt;create&lt;/span&gt; &lt;span class="mi"&gt;640&lt;/span&gt; &lt;span class="n"&gt;root&lt;/span&gt;
  &lt;span class="n"&gt;sharedscripts&lt;/span&gt;
  &lt;span class="n"&gt;postrotate&lt;/span&gt;
  &lt;span class="k"&gt;if&lt;/span&gt; &lt;span class="p"&gt;[&lt;/span&gt; &lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;f&lt;/span&gt; &lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="k"&gt;var&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;run&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;postfix&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;pid&lt;/span&gt; &lt;span class="p"&gt;];&lt;/span&gt; &lt;span class="n"&gt;then&lt;/span&gt;
  &lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;etc&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;init&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;d&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;postfix&lt;/span&gt; &lt;span class="n"&gt;reload&lt;/span&gt; &lt;span class="o"&gt;&amp;gt;&lt;/span&gt; &lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;dev&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="nb nb-Type"&gt;null&lt;/span&gt;
  &lt;span class="n"&gt;fi&lt;/span&gt;
  &lt;span class="n"&gt;endscript&lt;/span&gt;
  &lt;span class="p"&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;&lt;strong&gt;/var/log/maillog&lt;/strong&gt; : Correspond au fichier log à utiliser&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;daily&lt;/strong&gt; : La rotation s’effectuera tous les jours. Nous pouvons aussi mettre weekly pour toutes les semaines , monthly pour tous les mois.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;missingok&lt;/strong&gt; : signifie que l’absence du/des fichier(s) log(s) n’est pas anormale. Si cette option n’est pas active alors l’administrateur recevra un mail si le/les log(s) est/sont manquant(s).&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;rotate 52&lt;/strong&gt;: Nous garderons 52 fichiers. Soit pour mon cas, 52 jours de logs&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;compress&lt;/strong&gt; : Les fichiers logs secondaire c’est à dire tout ce qui n’est pas le fichier de log principal seront compréssés.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;delaycompress&lt;/strong&gt; : Reporte la compression du journal précédent au prochain cycle de permutation. Ceci n’a un effet qu’utilisé en combinaison avec l’option compress. Elle peut être utilisée quand il n’est pas possible de demander à un programme de fermer son journal et qu’il puisse par conséquent continuer à écrire pour un moment dans le journal précédent.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;notifempty&lt;/strong&gt; : permet de ne pas permuter le journal lorsqu’il est vide&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;create 640 root&lt;/strong&gt; : Les fichiers secondaire créés auront pour créateur root et auront les droits 640&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;postrotate/endscript&lt;/strong&gt; : Les lignes entre prerotate et endscript (chacun devant apparaître sur une ligne isolée) sont exécutées avant permutation du journal. Ces directives doivent apparaîtrent dans la définition d’un journal&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;sharedscripts&lt;/strong&gt; : permet d’executer qu’ une fois le script postrotate par rotation&lt;/p&gt;
&lt;h1&gt;Execution&lt;/h1&gt;
&lt;p&gt;Une fois que vous avez fini de configurer votre logrotate, vous pouvez forcer sont éxecution de cette manière :&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;logrotate -f  /etc/logrotate.conf
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;Pour débugger :&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;logrotate -d /etc/logrotate.conf
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;</content><category term="Linux"></category><category term="admin-sys"></category><category term="logrotate"></category></entry><entry><title>Package installé par taille</title><link href="https://fallen70.github.io/workbook/package-installe-par-taille.html" rel="alternate"></link><published>2021-08-06T13:50:00+02:00</published><updated>2021-08-06T13:50:00+02:00</updated><author><name>Fallen70</name></author><id>tag:fallen70.github.io,2021-08-06:/workbook/package-installe-par-taille.html</id><content type="html">&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;rpm -qa --queryformat &lt;span class="s1"&gt;&amp;#39;%10{size} - %-25{name} \t %{version}\n&amp;#39;&lt;/span&gt; &lt;span class="p"&gt;|&lt;/span&gt; sort -n
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;</content><category term="Linux"></category><category term="RedHat"></category><category term="admin-sys"></category></entry><entry><title>Subcription manager</title><link href="https://fallen70.github.io/workbook/subcription-manager.html" rel="alternate"></link><published>2021-08-06T13:50:00+02:00</published><updated>2021-08-06T13:50:00+02:00</updated><author><name>Fallen70</name></author><id>tag:fallen70.github.io,2021-08-06:/workbook/subcription-manager.html</id><summary type="html">&lt;h1&gt;Prérequis&lt;/h1&gt;
&lt;p&gt;Les commandes sont lancées en utilisant ansible et un inventory pour pouvoir propoager la configuration.&lt;/p&gt;
&lt;p&gt;Il faut évidemment disposer de licences redhat et d'un compte associé ( &lt;code&gt;&amp;lt;login&amp;gt;&lt;/code&gt; et '&lt;password&gt;' ).&lt;/p&gt;
&lt;h1&gt;Register&lt;/h1&gt;
&lt;p&gt;Source : &lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href="https://access.redhat.com/solutions/253273"&gt;https://access.redhat.com/solutions/253273&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;ansible all -i inventory -u ansible  -b --become-user&lt;span class="o"&gt;=&lt;/span&gt;root --become-method&lt;span class="o"&gt;=&lt;/span&gt;sudo -m redhat_subscription …&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;</summary><content type="html">&lt;h1&gt;Prérequis&lt;/h1&gt;
&lt;p&gt;Les commandes sont lancées en utilisant ansible et un inventory pour pouvoir propoager la configuration.&lt;/p&gt;
&lt;p&gt;Il faut évidemment disposer de licences redhat et d'un compte associé ( &lt;code&gt;&amp;lt;login&amp;gt;&lt;/code&gt; et '&lt;password&gt;' ).&lt;/p&gt;
&lt;h1&gt;Register&lt;/h1&gt;
&lt;p&gt;Source : &lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href="https://access.redhat.com/solutions/253273"&gt;https://access.redhat.com/solutions/253273&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;ansible all -i inventory -u ansible  -b --become-user&lt;span class="o"&gt;=&lt;/span&gt;root --become-method&lt;span class="o"&gt;=&lt;/span&gt;sudo -m redhat_subscription -a &lt;span class="s2"&gt;&amp;quot;state=present username=&amp;lt;login&amp;gt; password=&amp;lt;password&amp;gt; auto_attach=true&amp;quot;&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;h1&gt;Lock version&lt;/h1&gt;
&lt;p&gt;Source :&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href="https://access.redhat.com/solutions/238533"&gt;https://access.redhat.com/solutions/238533&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;ansible all -i inventory -u ansible  -b --become-user&lt;span class="o"&gt;=&lt;/span&gt;root --become-method&lt;span class="o"&gt;=&lt;/span&gt;sudo -m &lt;span class="s2"&gt;&amp;quot;command /usr/sbin/subscription-manager release --list&amp;quot;&lt;/span&gt;

ansible all -i inventory -u ansible  -b --become-user&lt;span class="o"&gt;=&lt;/span&gt;root --become-method&lt;span class="o"&gt;=&lt;/span&gt;sudo -m &lt;span class="s2"&gt;&amp;quot;command /usr/sbin/subscription-manager release --set=&amp;lt;version&amp;gt;&amp;quot;&lt;/span&gt;

ansible all -i inventory -u ansible  -b --become-user&lt;span class="o"&gt;=&lt;/span&gt;root --become-method&lt;span class="o"&gt;=&lt;/span&gt;sudo -m &lt;span class="s2"&gt;&amp;quot;command /usr/sbin/subscription-manager release --show&amp;quot;&lt;/span&gt;

ansible all -i inventory -u ansible  -b --become-user&lt;span class="o"&gt;=&lt;/span&gt;root --become-method&lt;span class="o"&gt;=&lt;/span&gt;sudo -m &lt;span class="s2"&gt;&amp;quot;command yum clean all&amp;quot;&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;h1&gt;Unsubscribe&lt;/h1&gt;
&lt;p&gt;Source :&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href="https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/6/html/installation_guide/ch-deregister_rhn_entitlement"&gt;https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/6/html/installation_guide/ch-deregister_rhn_entitlement&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;ansible all -i inventory -u ansible  -b --become-user&lt;span class="o"&gt;=&lt;/span&gt;root --become-method&lt;span class="o"&gt;=&lt;/span&gt;sudo -m &lt;span class="s2"&gt;&amp;quot;command /usr/sbin/subscription-manager unregister --username=&amp;lt;login&amp;gt;&amp;quot;&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;h2&gt;Redhat 7:&lt;/h2&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;ansible all -i inventory -u ansible  -b --become-user&lt;span class="o"&gt;=&lt;/span&gt;root --become-method&lt;span class="o"&gt;=&lt;/span&gt;sudo -m &lt;span class="s2"&gt;&amp;quot;command /usr/sbin/subscription-manager unregister&amp;quot;&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;</content><category term="Linux"></category><category term="RedHat"></category><category term="admin-sys"></category><category term="ansible"></category></entry><entry><title>Ulimit</title><link href="https://fallen70.github.io/workbook/ulimit.html" rel="alternate"></link><published>2021-08-06T13:50:00+02:00</published><updated>2021-08-06T13:50:00+02:00</updated><author><name>Fallen70</name></author><id>tag:fallen70.github.io,2021-08-06:/workbook/ulimit.html</id><content type="html">&lt;p&gt;Liste par process&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;lsof &lt;span class="p"&gt;|&lt;/span&gt; cut -d&lt;span class="se"&gt;\ &lt;/span&gt; -f1 &lt;span class="p"&gt;|&lt;/span&gt; sort &lt;span class="p"&gt;|&lt;/span&gt; uniq -c &lt;span class="p"&gt;|&lt;/span&gt; sort -nr &lt;span class="p"&gt;|&lt;/span&gt; less   
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;</content><category term="Linux"></category><category term="admin-sys"></category></entry><entry><title>RAM/SWAP</title><link href="https://fallen70.github.io/workbook/ramswap.html" rel="alternate"></link><published>2021-08-05T13:50:00+02:00</published><updated>2021-08-05T13:50:00+02:00</updated><author><name>Fallen70</name></author><id>tag:fallen70.github.io,2021-08-05:/workbook/ramswap.html</id><summary type="html">&lt;h1&gt;Swappiness&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href="https://geekeries.de-labrusse.fr/?p=1806"&gt;https://geekeries.de-labrusse.fr/?p=1806&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;sudo sysctl -w vm.swappiness&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="m"&gt;30&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;h1&gt;RAM &amp;amp; SWAP&lt;/h1&gt;
&lt;p&gt;Sources :&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href="https://www.vincentliefooghe.net/content/linux-gestion-la-ram-et-du-swap"&gt;https://www.vincentliefooghe.net/content/linux-gestion-la-ram-et-du-swap&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://linuxpedia.fr/doku.php/expert/analyser_usage_memoire_vive"&gt;https://linuxpedia.fr/doku.php/expert/analyser_usage_memoire_vive&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://www.selenic.com/smem/"&gt;https://www.selenic.com/smem/&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="k"&gt;for&lt;/span&gt; proc &lt;span class="k"&gt;in&lt;/span&gt; /proc/&lt;span class="o"&gt;[&lt;/span&gt;&lt;span class="m"&gt;0&lt;/span&gt;-9&lt;span class="o"&gt;]&lt;/span&gt;*&lt;span class="p"&gt;;&lt;/span&gt; &lt;span class="k"&gt;do&lt;/span&gt;   awk &lt;span class="s1"&gt;&amp;#39;/VmSwap/ { print $2 &amp;quot;\t&amp;#39;&lt;/span&gt;&lt;span class="sb"&gt;`&lt;/span&gt;readlink &lt;span class="nv"&gt;$proc&lt;/span&gt;/exe &lt;span class="p"&gt;|&lt;/span&gt; awk …&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;</summary><content type="html">&lt;h1&gt;Swappiness&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href="https://geekeries.de-labrusse.fr/?p=1806"&gt;https://geekeries.de-labrusse.fr/?p=1806&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;sudo sysctl -w vm.swappiness&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="m"&gt;30&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;h1&gt;RAM &amp;amp; SWAP&lt;/h1&gt;
&lt;p&gt;Sources :&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href="https://www.vincentliefooghe.net/content/linux-gestion-la-ram-et-du-swap"&gt;https://www.vincentliefooghe.net/content/linux-gestion-la-ram-et-du-swap&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://linuxpedia.fr/doku.php/expert/analyser_usage_memoire_vive"&gt;https://linuxpedia.fr/doku.php/expert/analyser_usage_memoire_vive&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://www.selenic.com/smem/"&gt;https://www.selenic.com/smem/&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="k"&gt;for&lt;/span&gt; proc &lt;span class="k"&gt;in&lt;/span&gt; /proc/&lt;span class="o"&gt;[&lt;/span&gt;&lt;span class="m"&gt;0&lt;/span&gt;-9&lt;span class="o"&gt;]&lt;/span&gt;*&lt;span class="p"&gt;;&lt;/span&gt; &lt;span class="k"&gt;do&lt;/span&gt;   awk &lt;span class="s1"&gt;&amp;#39;/VmSwap/ { print $2 &amp;quot;\t&amp;#39;&lt;/span&gt;&lt;span class="sb"&gt;`&lt;/span&gt;readlink &lt;span class="nv"&gt;$proc&lt;/span&gt;/exe &lt;span class="p"&gt;|&lt;/span&gt; awk &lt;span class="s1"&gt;&amp;#39;{ print $1 }&amp;#39;&lt;/span&gt;&lt;span class="sb"&gt;`&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;&amp;quot; }&amp;#39;&lt;/span&gt; &lt;span class="nv"&gt;$proc&lt;/span&gt;/status&lt;span class="p"&gt;;&lt;/span&gt; &lt;span class="k"&gt;done&lt;/span&gt; &lt;span class="p"&gt;|&lt;/span&gt; sort -n &lt;span class="p"&gt;|&lt;/span&gt; awk &lt;span class="s1"&gt;&amp;#39;{ total += $1 ; print $0 } END { print total &amp;quot;\tTotal&amp;quot;}&amp;#39;&lt;/span&gt;

&lt;span class="k"&gt;for&lt;/span&gt; file &lt;span class="k"&gt;in&lt;/span&gt; /proc/*/status &lt;span class="p"&gt;;&lt;/span&gt; &lt;span class="k"&gt;do&lt;/span&gt; awk &lt;span class="s1"&gt;&amp;#39;/Tgid|VmSwap|Name/{printf $2 &amp;quot; &amp;quot; $3}END{ print &amp;quot;&amp;quot;}&amp;#39;&lt;/span&gt; &lt;span class="nv"&gt;$file&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt; &lt;span class="k"&gt;done&lt;/span&gt; &lt;span class="p"&gt;|&lt;/span&gt; grep kB  &lt;span class="p"&gt;|&lt;/span&gt; sort -k &lt;span class="m"&gt;3&lt;/span&gt; -n
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;</content><category term="Linux"></category><category term="admin-sys"></category></entry><entry><title>TIME_WAIT</title><link href="https://fallen70.github.io/workbook/time_wait.html" rel="alternate"></link><published>2021-08-05T13:50:00+02:00</published><updated>2021-08-05T13:50:00+02:00</updated><author><name>Fallen70</name></author><id>tag:fallen70.github.io,2021-08-05:/workbook/time_wait.html</id><content type="html">&lt;p&gt;Sources :&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href="https://vincent.bernat.ch/fr/blog/2014-tcp-time-wait-state-linux"&gt;https://vincent.bernat.ch/fr/blog/2014-tcp-time-wait-state-linux&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://www.skyminds.net/serveur-dedie-reduire-les-connexions-time_wait-des-sockets-et-optimiser-tcp/"&gt;https://www.skyminds.net/serveur-dedie-reduire-les-connexions-time_wait-des-sockets-et-optimiser-tcp/&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;netstat -nat &lt;span class="p"&gt;|&lt;/span&gt; awk &lt;span class="s1"&gt;&amp;#39;{print $6}&amp;#39;&lt;/span&gt; &lt;span class="p"&gt;|&lt;/span&gt; sort &lt;span class="p"&gt;|&lt;/span&gt; uniq -c &lt;span class="p"&gt;|&lt;/span&gt; sort -n
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;</content><category term="Linux"></category><category term="netstat"></category><category term="admin-sys"></category></entry><entry><title>Création d'utilisateur</title><link href="https://fallen70.github.io/workbook/creation-dutilisateur.html" rel="alternate"></link><published>2021-08-05T13:40:00+02:00</published><updated>2021-08-05T13:40:00+02:00</updated><author><name>Fallen70</name></author><id>tag:fallen70.github.io,2021-08-05:/workbook/creation-dutilisateur.html</id><summary type="html">&lt;p&gt;Sources :&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href="https://www.starmate.fr/creer-un-utilisateur-et-son-passwd-en-une-commande/"&gt;https://www.starmate.fr/creer-un-utilisateur-et-son-passwd-en-une-commande/&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://stackoverflow.com/questions/14810684/check-whether-a-user-exists"&gt;https://stackoverflow.com/questions/14810684/check-whether-a-user-exists&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="c1"&gt;# Check if user exists&lt;/span&gt;
&lt;span class="k"&gt;if&lt;/span&gt; ! id -u &lt;span class="nv"&gt;$FS_USER&lt;/span&gt; &amp;gt; /dev/null &lt;span class="m"&gt;2&lt;/span&gt;&amp;gt;&lt;span class="p"&gt;&amp;amp;&lt;/span&gt;&lt;span class="m"&gt;1&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt; &lt;span class="k"&gt;then&lt;/span&gt;
    &lt;span class="nb"&gt;echo&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;The user does not exist; execute below commands to create and try again:&amp;quot;&lt;/span&gt;
    &lt;span class="nb"&gt;echo&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;  root@sh1:~# adduser --home /usr/local/freeswitch/ --shell /bin/false …&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;</summary><content type="html">&lt;p&gt;Sources :&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href="https://www.starmate.fr/creer-un-utilisateur-et-son-passwd-en-une-commande/"&gt;https://www.starmate.fr/creer-un-utilisateur-et-son-passwd-en-une-commande/&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://stackoverflow.com/questions/14810684/check-whether-a-user-exists"&gt;https://stackoverflow.com/questions/14810684/check-whether-a-user-exists&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="c1"&gt;# Check if user exists&lt;/span&gt;
&lt;span class="k"&gt;if&lt;/span&gt; ! id -u &lt;span class="nv"&gt;$FS_USER&lt;/span&gt; &amp;gt; /dev/null &lt;span class="m"&gt;2&lt;/span&gt;&amp;gt;&lt;span class="p"&gt;&amp;amp;&lt;/span&gt;&lt;span class="m"&gt;1&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt; &lt;span class="k"&gt;then&lt;/span&gt;
    &lt;span class="nb"&gt;echo&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;The user does not exist; execute below commands to create and try again:&amp;quot;&lt;/span&gt;
    &lt;span class="nb"&gt;echo&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;  root@sh1:~# adduser --home /usr/local/freeswitch/ --shell /bin/false --no-create-home --ingroup daemon --disabled-password --disabled-login &lt;/span&gt;&lt;span class="nv"&gt;$FS_USER&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;&lt;/span&gt;
    &lt;span class="nb"&gt;echo&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;  ...&amp;quot;&lt;/span&gt;
    &lt;span class="nb"&gt;echo&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;  root@sh1:~# chown freeswitch:daemon /usr/local/freeswitch/ -R&amp;quot;&lt;/span&gt;
    &lt;span class="nb"&gt;exit&lt;/span&gt; &lt;span class="m"&gt;1&lt;/span&gt;
&lt;span class="k"&gt;fi&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;</content><category term="Linux"></category><category term="admin-sys"></category></entry><entry><title>Nettoyage Jenkins</title><link href="https://fallen70.github.io/workbook/nettoyage-jenkins.html" rel="alternate"></link><published>2021-08-05T13:30:00+02:00</published><updated>2021-08-05T13:30:00+02:00</updated><author><name>Fallen70</name></author><id>tag:fallen70.github.io,2021-08-05:/workbook/nettoyage-jenkins.html</id><summary type="html">&lt;p&gt;Actions en s'appuyant sur les fichiers .pom:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Nettoyage des logs catalina&lt;/li&gt;
&lt;li&gt;Suppression du cache Jenkins&lt;/li&gt;
&lt;/ul&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="ch"&gt;#!/bin/bash&lt;/span&gt;

&lt;span class="nb"&gt;export&lt;/span&gt; &lt;span class="nv"&gt;TOMCAT_DIR&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;/path/to/jenkins/tomcat&amp;#39;&lt;/span&gt;
&lt;span class="nb"&gt;export&lt;/span&gt; &lt;span class="nv"&gt;CACHES_DIR&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;/path/to/jenkins/jenkins_data/caches&amp;#39;&lt;/span&gt;

&lt;span class="c1"&gt;# Clean catalina.out without restart&lt;/span&gt;
&lt;span class="nb"&gt;echo&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;Cleaning catalina.out&amp;#39;&lt;/span&gt;
&lt;span class="nb"&gt;echo&lt;/span&gt; &lt;span class="k"&gt;$(&lt;/span&gt;date&lt;span class="k"&gt;)&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39; Cleaned by XXXXX&amp;#39;&lt;/span&gt; &amp;gt; &lt;span class="si"&gt;${&lt;/span&gt;&lt;span class="nv"&gt;TOMCAT_DIR&lt;/span&gt;&lt;span class="si"&gt;}&lt;/span&gt;/logs/catalina.out

&lt;span class="c1"&gt;# Cleaning caches …&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;</summary><content type="html">&lt;p&gt;Actions en s'appuyant sur les fichiers .pom:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Nettoyage des logs catalina&lt;/li&gt;
&lt;li&gt;Suppression du cache Jenkins&lt;/li&gt;
&lt;/ul&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="ch"&gt;#!/bin/bash&lt;/span&gt;

&lt;span class="nb"&gt;export&lt;/span&gt; &lt;span class="nv"&gt;TOMCAT_DIR&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;/path/to/jenkins/tomcat&amp;#39;&lt;/span&gt;
&lt;span class="nb"&gt;export&lt;/span&gt; &lt;span class="nv"&gt;CACHES_DIR&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;/path/to/jenkins/jenkins_data/caches&amp;#39;&lt;/span&gt;

&lt;span class="c1"&gt;# Clean catalina.out without restart&lt;/span&gt;
&lt;span class="nb"&gt;echo&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;Cleaning catalina.out&amp;#39;&lt;/span&gt;
&lt;span class="nb"&gt;echo&lt;/span&gt; &lt;span class="k"&gt;$(&lt;/span&gt;date&lt;span class="k"&gt;)&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39; Cleaned by XXXXX&amp;#39;&lt;/span&gt; &amp;gt; &lt;span class="si"&gt;${&lt;/span&gt;&lt;span class="nv"&gt;TOMCAT_DIR&lt;/span&gt;&lt;span class="si"&gt;}&lt;/span&gt;/logs/catalina.out

&lt;span class="c1"&gt;# Cleaning caches dir&lt;/span&gt;
&lt;span class="nb"&gt;echo&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;Cleaning caches dir&amp;#39;&lt;/span&gt;
rm -rvf &lt;span class="si"&gt;${&lt;/span&gt;&lt;span class="nv"&gt;CACHES_DIR&lt;/span&gt;&lt;span class="si"&gt;}&lt;/span&gt;/*
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;</content><category term="Linux"></category><category term="Jenkins"></category><category term="admin-sys"></category></entry><entry><title>Nettoyage d'un repository M2</title><link href="https://fallen70.github.io/workbook/nettoyage-dun-repository-m2.html" rel="alternate"></link><published>2021-08-05T13:20:00+02:00</published><updated>2021-08-05T13:20:00+02:00</updated><author><name>Fallen70</name></author><id>tag:fallen70.github.io,2021-08-05:/workbook/nettoyage-dun-repository-m2.html</id><summary type="html">&lt;p&gt;Actions en s'appuyant sur les fichiers .pom:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Suppression des snapshots avec un ctime &amp;gt;14j&lt;/li&gt;
&lt;li&gt;Suppression des autres avec un atime &amp;gt; 60j&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;ctime -&amp;gt; date de création&lt;/p&gt;
&lt;p&gt;atime -&amp;gt; date de derniner accés&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="ch"&gt;#!/bin/bash&lt;/span&gt;

&lt;span class="nb"&gt;export&lt;/span&gt; &lt;span class="nv"&gt;MVN_REPO_DIR&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;/path/to/m2&amp;#39;&lt;/span&gt;

&lt;span class="c1"&gt;# Cleaning mvn SNAPSHOT repository&lt;/span&gt;
&lt;span class="nb"&gt;echo&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;Cleaning SNAPSHOT repository&amp;#39;&lt;/span&gt;
&lt;span class="k"&gt;for&lt;/span&gt; snapshot_dir &lt;span class="k"&gt;in&lt;/span&gt; &lt;span class="k"&gt;$(&lt;/span&gt;find &lt;span class="si"&gt;${&lt;/span&gt;&lt;span class="nv"&gt;MVN_REPO_DIR …&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;</summary><content type="html">&lt;p&gt;Actions en s'appuyant sur les fichiers .pom:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Suppression des snapshots avec un ctime &amp;gt;14j&lt;/li&gt;
&lt;li&gt;Suppression des autres avec un atime &amp;gt; 60j&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;ctime -&amp;gt; date de création&lt;/p&gt;
&lt;p&gt;atime -&amp;gt; date de derniner accés&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="ch"&gt;#!/bin/bash&lt;/span&gt;

&lt;span class="nb"&gt;export&lt;/span&gt; &lt;span class="nv"&gt;MVN_REPO_DIR&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;/path/to/m2&amp;#39;&lt;/span&gt;

&lt;span class="c1"&gt;# Cleaning mvn SNAPSHOT repository&lt;/span&gt;
&lt;span class="nb"&gt;echo&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;Cleaning SNAPSHOT repository&amp;#39;&lt;/span&gt;
&lt;span class="k"&gt;for&lt;/span&gt; snapshot_dir &lt;span class="k"&gt;in&lt;/span&gt; &lt;span class="k"&gt;$(&lt;/span&gt;find &lt;span class="si"&gt;${&lt;/span&gt;&lt;span class="nv"&gt;MVN_REPO_DIR&lt;/span&gt;&lt;span class="si"&gt;}&lt;/span&gt; -ctime +14 -type d -name &lt;span class="s1"&gt;&amp;#39;*-SNAPSHOT&amp;#39;&lt;/span&gt; &lt;span class="k"&gt;)&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
  &lt;span class="k"&gt;do&lt;/span&gt; rm -rvf &lt;span class="nv"&gt;$snapshot_dir&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
&lt;span class="k"&gt;done&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;

&lt;span class="c1"&gt;# Cleaning all mvn repository&lt;/span&gt;
&lt;span class="nb"&gt;echo&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;Cleaning all with atime &amp;gt; 60 days&amp;#39;&lt;/span&gt;
&lt;span class="k"&gt;for&lt;/span&gt; file &lt;span class="k"&gt;in&lt;/span&gt; &lt;span class="k"&gt;$(&lt;/span&gt;find &lt;span class="si"&gt;${&lt;/span&gt;&lt;span class="nv"&gt;MVN_REPO_DIR&lt;/span&gt;&lt;span class="si"&gt;}&lt;/span&gt; -atime +60 -type f -name &lt;span class="s1"&gt;&amp;#39;*.pom&amp;#39;&lt;/span&gt;&lt;span class="k"&gt;)&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt; 
  &lt;span class="k"&gt;do&lt;/span&gt; rm -rvf &lt;span class="k"&gt;$(&lt;/span&gt; dirname &lt;span class="nv"&gt;$file&lt;/span&gt; &lt;span class="k"&gt;)&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt; 
&lt;span class="k"&gt;done&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;</content><category term="Linux"></category><category term="Maven"></category><category term="admin-sys"></category></entry><entry><title>Nettoyage de fichier/dossier en fonction de la taille</title><link href="https://fallen70.github.io/workbook/nettoyage-de-fichierdossier-en-fonction-de-la-taille.html" rel="alternate"></link><published>2021-08-05T12:50:00+02:00</published><updated>2021-08-05T12:50:00+02:00</updated><author><name>Fallen70</name></author><id>tag:fallen70.github.io,2021-08-05:/workbook/nettoyage-de-fichierdossier-en-fonction-de-la-taille.html</id><content type="html">&lt;h1&gt;Liste de fichier qui dépassent une taille en byte&lt;/h1&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;du -s * &lt;span class="p"&gt;|&lt;/span&gt; sort -n &lt;span class="p"&gt;|&lt;/span&gt; awk  &lt;span class="s1"&gt;&amp;#39;{  if ( $1 &amp;gt; 400000 ) print $2; }&amp;#39;&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;h2&gt;Suppression du contenu trop volumineux&lt;/h2&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="k"&gt;for&lt;/span&gt; dir &lt;span class="k"&gt;in&lt;/span&gt; &lt;span class="k"&gt;$(&lt;/span&gt; du -s * &lt;span class="p"&gt;|&lt;/span&gt; sort -n &lt;span class="p"&gt;|&lt;/span&gt; awk  &lt;span class="s1"&gt;&amp;#39;{  if ( $1 &amp;gt; 400000 ) print $2; }&amp;#39;&lt;/span&gt; &lt;span class="k"&gt;)&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
  &lt;span class="k"&gt;do&lt;/span&gt; rm -rvf &lt;span class="nv"&gt;$dir&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
&lt;span class="k"&gt;done&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;</content><category term="Linux"></category><category term="admin-sys"></category></entry><entry><title>Formatage contenu</title><link href="https://fallen70.github.io/workbook/formatage-contenu.html" rel="alternate"></link><published>2021-08-05T10:00:00+02:00</published><updated>2021-08-05T10:00:00+02:00</updated><author><name>Fallen70</name></author><id>tag:fallen70.github.io,2021-08-05:/workbook/formatage-contenu.html</id><content type="html">&lt;h1&gt;Formater du contenu dans vim&lt;/h1&gt;
&lt;h2&gt;HTML&lt;/h2&gt;
&lt;p&gt;Installer l'utilitaire &lt;code&gt;tidy&lt;/code&gt;&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;:!tidy -mi -html -wrap 0 %
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;h2&gt;JSON&lt;/h2&gt;
&lt;p&gt;Nécessite python sur la machine&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="o"&gt;%!&lt;/span&gt;&lt;span class="n"&gt;python&lt;/span&gt; &lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;m&lt;/span&gt; &lt;span class="n"&gt;json&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="k"&gt;tool&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;</content><category term="Vim"></category><category term="html"></category><category term="json"></category></entry><entry><title>Installation VM Tools</title><link href="https://fallen70.github.io/workbook/installation-vm-tools.html" rel="alternate"></link><published>2021-08-05T08:40:00+02:00</published><updated>2021-08-05T08:40:00+02:00</updated><author><name>Fallen70</name></author><id>tag:fallen70.github.io,2021-08-05:/workbook/installation-vm-tools.html</id><content type="html">&lt;p&gt;A faire aprés modification du Kernel&lt;/p&gt;
&lt;p&gt;Aprés  lancement de la VM depuis le menu Périphérique choisir &lt;code&gt;Insérer l'image CD des Additions invité&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;&lt;img alt="Menu Virtualbox" src="https://fallen70.github.io/workbook/images/virtualbox/vm-tools.png"&gt;&lt;/p&gt;
&lt;h1&gt;Montage et éxecution du CD:&lt;/h1&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;sudo mount /dev/cdrom /mnt/cdrom
&lt;span class="nb"&gt;cd&lt;/span&gt; /mnt/cdrom/
sudo ./VBoxLinuxAdditions.run
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;</content><category term="Virtualbox"></category></entry><entry><title>Actions nexus avec curl</title><link href="https://fallen70.github.io/workbook/actions-nexus-avec-curl.html" rel="alternate"></link><published>2021-08-02T17:00:00+02:00</published><updated>2021-08-02T17:00:00+02:00</updated><author><name>Fallen70</name></author><id>tag:fallen70.github.io,2021-08-02:/workbook/actions-nexus-avec-curl.html</id><content type="html">&lt;h1&gt;Upload&lt;/h1&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;curl -v --user &lt;span class="s1"&gt;&amp;#39;user:pass&amp;#39;&lt;/span&gt; --upload-file /path/to/file http://nexus/nexus/repository/component/subfolder/file
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;h1&gt;Delete&lt;/h1&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;curl -X DELETE -v --user  &lt;span class="s1"&gt;&amp;#39;user:pass&amp;#39;&lt;/span&gt;  http://nexus/nexus/repository/component/subfolder/file
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;</content><category term="Curl"></category><category term="nexus"></category><category term="admin-sys"></category></entry><entry><title>Find et lien symbolique</title><link href="https://fallen70.github.io/workbook/find-et-lien-symbolique.html" rel="alternate"></link><published>2021-08-02T16:20:00+02:00</published><updated>2021-08-02T16:20:00+02:00</updated><author><name>Fallen70</name></author><id>tag:fallen70.github.io,2021-08-02:/workbook/find-et-lien-symbolique.html</id><summary type="html">&lt;p&gt;Tiré de &lt;a href="https://stackoverflow.com/questions/8513133/how-do-i-find-all-of-the-symlinks-in-a-directory-tree/21438684"&gt;https://stackoverflow.com/questions/8513133/how-do-i-find-all-of-the-symlinks-in-a-directory-tree/21438684&lt;/a&gt;&lt;/p&gt;
&lt;h1&gt;Find symbolic links&lt;/h1&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;find . -type l -ls
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;h1&gt;Find symbolic links to a specific target&lt;/h1&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;find . -lname link_target
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;Note that link_target may contain wildcard characters.&lt;/p&gt;
&lt;h1&gt;Find broken symbolic links&lt;/h1&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;find -L . -type l -ls
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;The -L option instructs find to follow symbolic …&lt;/p&gt;</summary><content type="html">&lt;p&gt;Tiré de &lt;a href="https://stackoverflow.com/questions/8513133/how-do-i-find-all-of-the-symlinks-in-a-directory-tree/21438684"&gt;https://stackoverflow.com/questions/8513133/how-do-i-find-all-of-the-symlinks-in-a-directory-tree/21438684&lt;/a&gt;&lt;/p&gt;
&lt;h1&gt;Find symbolic links&lt;/h1&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;find . -type l -ls
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;h1&gt;Find symbolic links to a specific target&lt;/h1&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;find . -lname link_target
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;Note that link_target may contain wildcard characters.&lt;/p&gt;
&lt;h1&gt;Find broken symbolic links&lt;/h1&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;find -L . -type l -ls
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;The -L option instructs find to follow symbolic links, unless when broken.&lt;/p&gt;
&lt;h1&gt;Find &amp;amp; replace broken symbolic links&lt;/h1&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;find -L . -type l -delete -exec ln -s new_target &lt;span class="o"&gt;{}&lt;/span&gt; &lt;span class="se"&gt;\;&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;More find examples can be found here: &lt;a href="https://hamwaves.com/find/"&gt;https://hamwaves.com/find/&lt;/a&gt;&lt;/p&gt;</content><category term="Linux"></category><category term="find"></category><category term="sym-links"></category></entry><entry><title>Test StickySession avec curl</title><link href="https://fallen70.github.io/workbook/test-stickysession-avec-curl.html" rel="alternate"></link><published>2021-08-02T13:15:00+02:00</published><updated>2021-08-02T13:15:00+02:00</updated><author><name>Fallen70</name></author><id>tag:fallen70.github.io,2021-08-02:/workbook/test-stickysession-avec-curl.html</id><summary type="html">&lt;p&gt;Méthode pour tester la session sur plusieurs loadbalancers avec curl.&lt;/p&gt;
&lt;p&gt;En parallèle vérifier que la route est bien respectée en surveillant les logs des machine ciblées par les routes&lt;/p&gt;
&lt;p&gt;Explication sur certaines options de curl&lt;/p&gt;
&lt;p&gt;-H 'host:ServerName' pour cibler un vhost par son ServerName&lt;/p&gt;
&lt;p&gt;--cookie-jar /tmp/cookie Sauver le …&lt;/p&gt;</summary><content type="html">&lt;p&gt;Méthode pour tester la session sur plusieurs loadbalancers avec curl.&lt;/p&gt;
&lt;p&gt;En parallèle vérifier que la route est bien respectée en surveillant les logs des machine ciblées par les routes&lt;/p&gt;
&lt;p&gt;Explication sur certaines options de curl&lt;/p&gt;
&lt;p&gt;-H 'host:ServerName' pour cibler un vhost par son ServerName&lt;/p&gt;
&lt;p&gt;--cookie-jar /tmp/cookie Sauver le cookie&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Récupérer le cookie &lt;/li&gt;
&lt;/ul&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;curl --cookie-jar /tmp/cookie   -v -I -H &amp;#39;host:ServerName&amp;#39; monserveur.cible-01
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;Dans la sortie console on aura l'ionformation de création du  &lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="o"&gt;*&lt;/span&gt; &lt;span class="nt"&gt;Added&lt;/span&gt; &lt;span class="nt"&gt;cookie&lt;/span&gt; &lt;span class="nt"&gt;ROUTEID&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;.1&amp;quot;&lt;/span&gt; &lt;span class="nt"&gt;for&lt;/span&gt; &lt;span class="nt"&gt;domain&lt;/span&gt; &lt;span class="nt"&gt;ServerName&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt; &lt;span class="nt"&gt;path&lt;/span&gt; &lt;span class="o"&gt;/,&lt;/span&gt; &lt;span class="nt"&gt;expire&lt;/span&gt; &lt;span class="nt"&gt;0&lt;/span&gt;
&lt;span class="o"&gt;&amp;lt;&lt;/span&gt; &lt;span class="nt"&gt;Set-Cookie&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="nt"&gt;ROUTEID&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nc"&gt;1&lt;/span&gt;&lt;span class="o"&gt;;&lt;/span&gt; &lt;span class="nt"&gt;path&lt;/span&gt;&lt;span class="o"&gt;=/&lt;/span&gt;
&lt;span class="nt"&gt;Set-Cookie&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="nt"&gt;ROUTEID&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nc"&gt;1&lt;/span&gt;&lt;span class="o"&gt;;&lt;/span&gt; &lt;span class="nt"&gt;path&lt;/span&gt;&lt;span class="o"&gt;=/&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;ul&gt;
&lt;li&gt;Utiliser le cookie sur une autre adresse partageant un Servername&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;--cookie /tmp/cookie Utilise le cookie créé&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;curl --cookie /tmp/cookie   -v -I -H &amp;#39;host:ServerName&amp;#39; monserveur.cible-02
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;Le cookie est bien exploité&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&amp;gt; HEAD / HTTP/1.1
&amp;gt; User-Agent: curl/7.29.0
&amp;gt; Accept: */*
&amp;gt; Cookie: ROUTEID=.1
&amp;gt; host:ServerName
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;</content><category term="Curl"></category><category term="load-balancer"></category></entry></feed>